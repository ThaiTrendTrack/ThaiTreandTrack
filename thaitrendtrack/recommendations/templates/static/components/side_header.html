<!DOCTYPE html>
<html lang="en">
<head>
    <title>ThaiTrendTrack</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200&family=Roboto+Condensed&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=search" rel="stylesheet">
    <style>
      body {
        margin: 0;
        background-color: white;
        font-family: 'Poppins', sans-serif;
        font-weight: bold;
      }

      .flex-center {
        display: flex;
        justify-content: center;
      }

      nav {
        position: fixed;
        width: 100%;
        height: 90px;
        display: flex;
        /*justify-content: space-between;*/
        align-items: center;
        background-color: white;
        padding: 0 5px;
        z-index: 999999;
      }

      ul {
        padding-left: 0;
        display: flex;
        list-style-type: none;
      }

      .logo {
        text-align: center;
      }

      .logo img {
        width: 80px;
        height: auto;
        padding-top: 9px;
        padding-left: 15px;
      }

      .menu {
        display: flex;
        justify-content: center;
        align-items: center;
        /*margin-left: 20px;*/
      }

      .menu li {
        float: left;
        padding-left: 30px;
        list-style-type: none;
      }

      .menu-text a {
        color: black;
        list-style-type: none;
        text-decoration: none ;
        font-size: 18px;
      }

      .menu-text a:hover {
        color: #DC0856;
      }


      .left-nav {
            display: flex;
            align-items: center;
      }


    .dropdown {
        background: #EEEEEE;
        color: black;
        font-size: 14px;
        font-weight: bold;
        font-family: 'Poppins', sans-serif;
        border: 2px solid #EEEEEE;
        padding: 10px 16px;
        border-radius: 24px 0 0 24px; /* Rounded left edge */
        cursor: pointer;
        outline: none;
        width: 120px;
    }
    .search-input {
        font-size: 14px;
        font-family: 'Poppins', sans-serif;
        color: black;
        border: none;
        background: transparent;
        flex: 1;
        padding: 10px;
        outline: none;
    }

    .search-button {
        background: transparent;
        border: none;
        color: #DC0856;
        font-size: 18px;
        padding: 10px 14px;
        cursor: pointer;
        border-radius: 0 24px 24px 0; /* Rounded right edge */
    }

    .material-symbols-outlined {
        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

      .nav-icons {
        display: flex;
        align-items: center;
        margin-left: 25px;
      }

      .nav-icons a {
        margin-left: 15px;
        width: 28px;
        height: 28px;
        display: inline-flex;
      }

      .nav-icons a:hover svg {
        fill: #DC0856;
      }

      .nav-icons svg {
        fill: black;
        width: 100%;
        height: 100%;
        transition: fill 0.3s;
      }

      .nav-icons span {
        margin: 0 20px 0 30px;
        font-size: 26px;
        color: #DC0856;
      }

      .account {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        object-fit: cover;
        margin-left: 6px;
        margin-top: -4px;
     }

     /* .profile-photo {*/
     /*   width: 32px;*/
     /*   height: 32px;*/
     /*   border-radius: 50%;*/
     /*   object-fit: cover;*/
     /*   margin-left: 6px;*/
     /*   margin-top: -6px;*/
     /*   border: 2px solid black;*/
     /*}*/

      .user svg {
        fill: white;
        padding-left: 2px;
      }

      .user {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 30px;
        white-space: nowrap;
        margin-right: 40px;
      }

      .user li {
        list-style-type: none;
        padding-top: 9px;
        margin: 0;
      }

      .line {
        margin: 0 8px;
      }

.search-container {
    display: flex;
    justify-content: space-between; /* ให้ input กับปุ่มอยู่ข้างกัน */
    align-items: center;
    background: white;
    border-radius: 24px;
    overflow: hidden;
    width:300px;  /* ลดขนาดความกว้างของ search bar */
    height: 42px;
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.15);
    border: 1.5px solid black;
    z-index: 999999;
    margin-left: 20px;
    padding: 0 10px;
}

.search-input {
    font-size: 14px;
    font-family: 'Poppins', sans-serif;
    color: black;
    border: none;
    background: transparent;
    flex-grow: 1; /* ให้ input ขยายเต็มพื้นที่ */
    padding: 10px;
    outline: none;
    margin-right: 5px; /* ลดระยะห่างระหว่าง input กับปุ่ม */
    max-width: 250px;  /* จำกัดขนาดของ input */
}

.search-button {
    background: transparent;
    border: none;
    color: #DC0856;
    font-size: 18px;
    padding: 10px 14px;
    cursor: pointer;
    border-radius: 0 24px 24px 0; /* ปรับมุมขวาของปุ่ม */
}

/* Ensure the search icon is pushed to the right */
.search-bar {
    display: flex;
    justify-content: space-between;
    width: 100%; /* Makes sure it takes up full width of the container */
}

.material-symbols-outlined {
    margin-left: auto; /* Pushes the icon to the far right */
}

.advanced-search-btn {
    background: #DC0856;
    color: white;
    border: none;
    font-size: 14px;
    font-weight: bolder;
    padding: 10px 16px;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.3s;
    margin-left: 5px;  /* ลดระยะห่างจาก input */
}

 .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup {
            background: white;
            padding: 20px;
            width: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            text-align: left;
            display: flex;
            flex-direction: column;
        }

        .popup h2 {
            margin: 0 0 15px;
            font-size: 20px;
            font-weight: bold;
        }

        .popup label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .popup input, .popup select {
            width: 100%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .popup-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .cancel-btn, .apply-btn {
            padding: 10px 16px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .cancel-btn {
            background: lightgrey;
            color: black;
        }

        .apply-btn {
            background: #DC0856;
            color: white;
            border: none;
        }

        .apply-btn:hover {
            background: black;
        }

        .popup input[type="date"] {
            width: 48%;
        }

        .popup .date-range {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .popup .date-range input {
            width: 48%;
        }

</style>
</head>

<body>
    <nav>
      <div class="left-nav flex-center">
        <div class="logo">
          <img src="/static/logo/TTT-logo1.png" alt="logo">
        </div>
        <div class="menu">
          <ul>
            <li class="menu-text"><a href="/homepage/">Home</a></li>
            <li class="menu-text"><a href="{% url 'movies' %}">Movies</a></li>
            <li class="menu-text"><a href="{% url 'series' %}">Series</a></li>
            <li class="menu-text"><a href="{% url 'drama' %}">Drama</a></li>
          </ul>
        </div>
      </div>

<!-- Center Section: Search Bar -->
<div class="search-container">
    <form action="{% url 'recommend' %}" method="get" class="search-bar">
        <input type="text" class="search-input" name="searchQuery" placeholder="Search..." required>
        <button type="submit" class="search-button">
            <span class="material-symbols-outlined">search</span>
        </button>
    </form>
</div><button class="advanced-search-btn" onclick="openPopup()">Advanced Search</button>



<script>
    document.getElementById("search-form").addEventListener("submit", function(event) {
        const query = document.getElementById("searchQuery").value.trim();

        if (!query) {
            alert("Please enter a search term.");
            event.preventDefault();  // Prevent form submission if empty
        }
    });
</script>




      <div class="nav-icons">
          <a href="{% url 'home' %}">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368">
                  <path d="M880-80 720-240H320q-33 0-56.5-23.5T240-320v-40h440q33 0 56.5-23.5T760-440v-280h40q33 0 56.5 23.5T880-640v560ZM160-473l47-47h393v-280H160v327ZM80-280v-520q0-33 23.5-56.5T160-880h440q33 0 56.5 23.5T680-800v280q0 33-23.5 56.5T600-440H240L80-280Zm80-240v-280 280Z"/>
              </svg>
          </a>

          <a href="#" class="bookmark-icon">
              <svg class="bookmark-icon" viewBox="0 0 512 512" version="1.1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g id="Layer_1"/><g id="Layer_2">
                  <g><path class="st0" d="M112.9,43.5v344.14L256,468.5l143.1-80.86V43.5H112.9z M340.55,211.58l-35.15,30.74    c-2.35,2.06-3.38,5.23-2.69,8.28l10.37,45.53c1.66,7.28-6.22,13.01-12.63,9.18l-40.09-23.94c-2.68-1.6-6.02-1.6-8.71,0    l-40.09,23.94c-6.41,3.83-14.29-1.89-12.63-9.18l10.37-45.53c0.69-3.04-0.34-6.22-2.69-8.28l-35.15-30.74    c-5.62-4.92-2.62-14.18,4.82-14.85l46.51-4.2c3.11-0.28,5.81-2.25,7.04-5.12l18.37-42.93c2.94-6.87,12.67-6.87,15.61,0    l18.37,42.93c1.23,2.87,3.93,4.84,7.04,5.12l46.51,4.2C343.16,197.41,346.17,206.67,340.55,211.58z"/></g>
              </g>
              </svg>
          </a>

          <a href="{% url 'home' %}">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368">
                  <path d="M160-200v-80h80v-280q0-83 50-147.5T420-792v-28q0-25 17.5-42.5T480-880q25 0 42.5 17.5T540-820v28q80 20 130 84.5T720-560v280h80v80H160Zm320-300Zm0 420q-33 0-56.5-23.5T400-160h160q0 33-23.5 56.5T480-80ZM320-280h320v-280q0-66-47-113t-113-47q-66 0-113 47t-47 113v280Z"/>
              </svg>
          </a>

          <a href="{% url 'home' %}">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368">
                  <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/>
              </svg>
          </a>
          <span class="line">|</span>
          <div class="user">
              <li class="menu-text"><a href="/login/">Log in</a></li>
              <li class="menu-text"><a href="/signup/">Sign up</a></li>
          </div>

<!--          <h3 class="name">NichaParich02</h3>-->

          <a href="/settings/">
	        <img src="/static/icons/user.png" alt="Profile Photo" class="account">
          </a>
<!--          <a href="{% url '//' %}">-->
<!--	        <img src="../static/icons/NichaParich.png" alt="Profile Photo" class="profile-photo">-->
<!--          </a>-->
      </div>
    </nav>

<!-- Advanced Search Button -->
<button class="advanced-search-btn" onclick="openPopup()">Advanced Search</button>

<!-- Popup Overlay -->
<div class="popup-overlay" id="popupOverlay" style="display: none;">
    <div class="popup">
        <h2>Advanced Search</h2>
        <label>Genre:</label>
        <select>
            <option value="" disabled selected>Select Genre</option>
            <option value="Action">Action</option>
            <option value="Adventure">Adventure</option>
            <option value="Animation">Animation</option>
            <option value="Comedy">Comedy</option>
            <option value="Crime">Crime</option>
            <option value="Documentary">Documentary</option>
            <option value="Drama">Drama</option>
            <option value="Family">Family</option>
            <option value="Fantasy">Fantasy</option>
            <option value="History">History</option>
            <option value="Horror">Horror</option>
            <option value="Music">Music</option>
            <option value="Mystery">Mystery</option>
            <option value="Romance">Romance</option>
            <option value="Science Fiction">Science Fiction</option>
            <option value="Thriller">Thriller</option>
            <option value="TV Movie">TV Movie</option>
            <option value="War">War</option>
            <option value="Western">Western</option>
        </select>
        <label>Cast:</label>
        <input type="text" placeholder="Enter cast name">
        <label>Description:</label>
        <input type="text" placeholder="Enter description">
        <label>Published Date:</label>
        <div class="date-range">
            <input type="date" id="start-date">
            <span>-</span>
            <input type="date" id="end-date">
        </div>
        <div class="popup-actions">
            <button class="cancel-btn" onclick="closePopup()">Cancel</button>
            <button class="apply-btn" onclick="submitAdvancedSearch()">Apply</button>
        </div>
    </div>
</div>

 <script>
        // เปิดป๊อปอัพ
        function openPopup() {
            document.getElementById('popupOverlay').style.display = 'flex';
        }

        // ปิดป๊อปอัพ
        function closePopup() {
            document.getElementById('popupOverlay').style.display = 'none';
        }

        // ฟังก์ชันเมื่อคลิกปุ่ม Apply
        function submitAdvancedSearch() {
            console.log('Apply button clicked'); // ตรวจสอบว่าเปิดใช้งานแล้ว

            // รับข้อมูลจากฟอร์ม
            const genre = document.getElementById('genre-select').value;
            const cast = document.getElementById('cast-input').value;
            const description = document.getElementById('description-input').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            console.log("Data being sent:", { genre, cast, description, startDate, endDate });

            // เตรียมข้อมูลเพื่อส่ง
            const data = {
                genre: genre || null,
                cast: cast || null,
                description: description || null,
                start_date: startDate || null,
                end_date: endDate || null
            };

            // ส่งข้อมูลไปยัง backend
            fetch("{% url 'recommend_advanced' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(data => {
                console.log("Backend response:", data);

                if (data.movies) {
                    // เก็บข้อมูลหนังที่แนะนำลงใน localStorage
                    localStorage.setItem('recommendedMovies', JSON.stringify(data.movies));
                    window.location.href = "/movies_advance/";  // เปลี่ยนหน้าไปยังหน้าผลลัพธ์
                } else {
                    console.log("No movies found.");
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
</body>
</html>
